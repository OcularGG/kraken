<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Port Battle Sign-up | KRAKEN</title>    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="krakenlogo.png">
    <script src="js/deployment-fixes.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #181818;
            color: #fff;
            padding-top: 100px;
            line-height: 1.6;
        }
        
        .signup-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 2rem;
            background: #2a2a2a;
            border: 4px solid #bfa140;
            box-shadow: 8px 8px 0px #bfa140;
        }
        
        .signup-header {
            text-align: center;
            margin-bottom: 3rem;
            padding-bottom: 2rem;
            border-bottom: 3px solid #bfa140;
        }
        
        .pb-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .pb-details, .br-info {
            background: #1a1a1a;
            padding: 1.5rem;
            border: 2px solid #bfa140;
        }
        
        .pb-details h3, .br-info h3 {
            color: #bfa140;
            margin-bottom: 1rem;
            text-transform: uppercase;
        }
        
        .detail-item {
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
        }
        
        .detail-label {
            color: #bfa140;
            font-weight: 600;
        }
        
        .fleet-section {
            background: #1a1a1a;
            border: 2px solid #bfa140;
            margin-bottom: 2rem;
        }
        
        .fleet-header {
            background: #bfa140;
            color: #181818;
            padding: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            text-align: center;
        }
        
        .fleet-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .fleet-table th {
            background: #2a2a2a;
            color: #bfa140;
            padding: 0.75rem;
            text-align: left;
            border-bottom: 2px solid #bfa140;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.9rem;
        }
        
        .fleet-table td {
            padding: 0.5rem;
            border-bottom: 1px solid #444;
        }
        
        .fleet-table input, .fleet-table select {
            width: 100%;
            padding: 0.5rem;
            background: #181818;
            border: 1px solid #bfa140;
            color: #fff;
            font-family: 'Space Grotesk', sans-serif;
            font-size: 0.9rem;
        }
        
        .fleet-table input:focus, .fleet-table select:focus {
            outline: none;
            border-color: #fff;
        }
        
        .ship-cell {
            background: #2a2a2a;
            font-weight: 600;
            color: #bfa140;
        }
        
        .br-cell {
            text-align: center;
            font-weight: 600;
            color: #bfa140;
        }
        
        .signed-up {
            background: rgba(191, 161, 64, 0.2);
        }
        
        .clans-list {
            background: #1a1a1a;
            border: 2px solid #bfa140;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .clans-list h3 {
            color: #bfa140;
            margin-bottom: 1rem;
            text-transform: uppercase;
            text-align: center;
        }
        
        .clans-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.5rem;
            text-align: center;
        }
        
        .clan-tag {
            background: #2a2a2a;
            color: #bfa140;
            padding: 0.5rem;
            border: 1px solid #bfa140;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .signup-container {
                margin: 1rem;
                padding: 1rem;
            }
            
            .pb-info-grid {
                grid-template-columns: 1fr;
            }
            
            .fleet-table {
                font-size: 0.8rem;
            }
            
            .fleet-table th, .fleet-table td {
                padding: 0.5rem 0.25rem;
            }
            
            .clans-grid {
                grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Sticky Navigation Menu -->
    <nav class="kraken-navbar">
        <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="marketplace.html">Marketplace</a></li>
            <li><a href="tools.html">Tools</a></li>
            <li><a href="orgchart.html">Command</a></li>
            <li><a href="pb.html">PB</a></li>
            <li><a href="apply-typeform.html">Apply</a></li>
        </ul>
    </nav>

    <div class="signup-container">
        <header class="signup-header">
            <h1 class="pb-title" id="pb-title">Port Battle Sign-up</h1>
            <p class="pb-subtitle" id="pb-subtitle">Fleet Operations Coordination</p>
        </header>

        <div class="pb-info-grid">
            <div class="pb-details">
                <h3>Operation Details</h3>
                <div class="detail-item">
                    <span class="detail-label">Port:</span>
                    <span id="port-name">Santo Domingo</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Type:</span>
                    <span id="battle-type">Deep Water</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Meeting Time:</span>
                    <span id="meeting-time">23/06/2025 19:00 UTC</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Battle Time:</span>
                    <span id="battle-time">23/06/2025 20:00 UTC</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Meeting Location:</span>
                    <span id="meeting-location">Port-au-Prince</span>
                </div>
            </div>
            
            <div class="br-info">
                <h3>Fleet Composition</h3>
                <div class="detail-item">
                    <span class="detail-label">BR Limit:</span>
                    <span id="br-limit">5000</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">BR Used:</span>
                    <span id="br-used">3420</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">BR Remaining:</span>
                    <span id="br-remaining" style="color: #4ade80;">1580</span>
                </div>
                <div class="detail-item">
                    <span class="detail-label">Ships Signed:</span>
                    <span id="ships-signed">15/70</span>
                </div>
            </div>
        </div>

        <div class="clans-list">
            <h3>RvR Clans</h3>
            <div class="clans-grid" id="clans-grid">
                <!-- Clans will be populated by JavaScript -->
            </div>
        </div>

        <div class="fleet-section">
            <div class="fleet-header">Fleet Composition</div>
            <table class="fleet-table" id="fleet-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th style="width: 15%;">Ship</th>
                        <th style="width: 8%;">BR</th>
                        <th style="width: 8%;">Books</th>
                        <th style="width: 15%;">Alt Ship</th>
                        <th style="width: 8%;">Alt Books</th>
                        <th style="width: 8%;">Screen?</th>
                        <th style="width: 15%;">Player Name</th>
                        <th style="width: 10%;">Clan</th>
                        <th style="width: 8%;">Comments</th>
                    </tr>
                </thead>                <tbody id="fleet-tbody">
                    <!-- Fleet rows will be generated by JavaScript -->
                </tbody>
            </table>        </div>

        <!-- Screening Fleets Section -->
        <div id="screening-section" style="display: none;">
            <h2 style="color: #bfa140; text-align: center; margin: 2rem 0;">Screening Fleets</h2>
            <div id="screening-fleets-container">
                <!-- Screening fleets will be populated by JavaScript -->
            </div>
        </div>

        <div class="fleet-section">
            <div class="fleet-header">Approved Participants</div>
            <table class="fleet-table" id="approved-table">
                <thead>
                    <tr>
                        <th style="width: 5%;">#</th>
                        <th style="width: 20%;">Player Name</th>
                        <th style="width: 15%;">Ship</th>
                        <th style="width: 10%;">BR</th>
                        <th style="width: 15%;">Alt Ship</th>
                        <th style="width: 10%;">Role</th>
                        <th style="width: 15%;">Clan</th>
                        <th style="width: 10%;">Status</th>
                    </tr>
                </thead>
                <tbody id="approved-tbody">
                    <!-- Approved participants will be loaded here -->
                </tbody>
            </table>
            <div id="no-approved" style="text-align: center; padding: 2rem; color: #bfa140;">
                No participants approved yet. Check back later or contact the fleet commander.
            </div>
        </div>
    </div>    <script>
        // Get URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const pbId = urlParams.get('id');
        const accessCode = urlParams.get('code');

        // Load PB data from localStorage
        let currentPB = null;
        
        function loadPBData() {
            const savedData = localStorage.getItem('krakenPBData');
            if (savedData) {
                const portBattles = JSON.parse(savedData);
                currentPB = portBattles.find(pb => pb.id === pbId);
                
                // Verify access code
                if (!currentPB) {
                    alert('Port Battle not found!');
                    window.close();
                    return false;
                }
                
                if (!accessCode || accessCode !== currentPB.accessCode) {
                    alert('Invalid or missing access code!');
                    window.close();
                    return false;
                }
                
                return true;
            } else {
                alert('No port battle data found!');
                window.close();
                return false;
            }
        }

        function formatDateTime(dateStr) {
            return new Date(dateStr).toLocaleString('en-GB', {
                timeZone: 'UTC',
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }) + ' UTC';
        }        function loadPBDetails() {
            if (!currentPB) return;
            
            document.getElementById('pb-title').textContent = `${currentPB.port} Port Battle`;
            document.getElementById('port-name').textContent = currentPB.port;
            document.getElementById('battle-type').textContent = currentPB.type === 'deep' ? 'Deep Water' : 'Shallow Water';
            document.getElementById('meeting-time').textContent = formatDateTime(currentPB.meetingTime);
            document.getElementById('battle-time').textContent = formatDateTime(currentPB.pbTime);
            document.getElementById('meeting-location').textContent = currentPB.meetingLocation;
            document.getElementById('br-limit').textContent = currentPB.brLimit;
            
            // Load screening fleets if they exist
            if (currentPB.screening && currentPB.screening.fleets && currentPB.screening.fleets.length > 0) {
                loadScreeningFleets();
            }
        }

        function loadScreeningFleets() {
            const screeningSection = document.getElementById('screening-section');
            const container = document.getElementById('screening-fleets-container');
            
            screeningSection.style.display = 'block';
            container.innerHTML = '';
            
            currentPB.screening.fleets.forEach((fleet, index) => {
                const fleetDiv = document.createElement('div');
                fleetDiv.className = 'fleet-section';
                fleetDiv.style.marginBottom = '2rem';
                
                fleetDiv.innerHTML = `
                    <div class="fleet-header">
                        Screening Fleet ${fleet.id} - ${fleet.nation} 
                        <span style="float: right; font-size: 0.9rem;">
                            Commander: ${fleet.commander} | 
                            ${currentPB.screening.type === 'defensive' ? 'Defensive' : 'Offensive'} Screening
                        </span>
                    </div>
                    <div style="padding: 1rem; background: #1a1a1a; border: 2px solid #bfa140; border-top: none;">
                        <div style="margin-bottom: 1rem;">
                            <strong>BR Limit:</strong> ${currentPB.screening.brLimit} | 
                            <strong>Ship Selection:</strong> ${currentPB.screening.shipSelectionType === 'rates' ? 'Ship Rates (' + currentPB.screening.allowedRates.join(', ') + ')' : 'Specific Ships'}
                        </div>
                        <div class="screening-signup-form" id="screening-form-${fleet.id}">
                            <h4 style="color: #bfa140; margin-bottom: 1rem;">Sign Up for This Fleet</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 1rem; align-items: end;">
                                <div>
                                    <label style="color: #bfa140; display: block; margin-bottom: 0.5rem;">Player Name</label>
                                    <input type="text" id="player-name-${fleet.id}" placeholder="Your name" style="width: 100%; padding: 0.5rem; background: #181818; border: 1px solid #bfa140; color: #fff;">
                                </div>
                                <div>
                                    <label style="color: #bfa140; display: block; margin-bottom: 0.5rem;">Clan</label>
                                    <select id="clan-${fleet.id}" style="width: 100%; padding: 0.5rem; background: #181818; border: 1px solid #bfa140; color: #fff;">
                                        <option value="">Select Clan</option>
                                    </select>
                                </div>
                                <div>
                                    <label style="color: #bfa140; display: block; margin-bottom: 0.5rem;">Ship</label>
                                    <input type="text" id="ship-${fleet.id}" placeholder="Ship name" style="width: 100%; padding: 0.5rem; background: #181818; border: 1px solid #bfa140; color: #fff;">
                                </div>
                                <div>
                                    <label style="color: #bfa140; display: block; margin-bottom: 0.5rem;">BR</label>
                                    <input type="number" id="br-${fleet.id}" placeholder="BR" style="width: 100%; padding: 0.5rem; background: #181818; border: 1px solid #bfa140; color: #fff;">
                                </div>
                                <div>
                                    <button type="button" onclick="signUpForScreening('${fleet.id}')" class="btn btn-small" style="padding: 0.5rem 1rem;">Sign Up</button>
                                </div>
                            </div>
                        </div>
                        <div class="screening-signups" id="screening-signups-${fleet.id}" style="margin-top: 2rem;">
                            <h4 style="color: #bfa140; margin-bottom: 1rem;">Current Sign-ups (${fleet.signups ? fleet.signups.length : 0}/70)</h4>
                            <div id="signups-list-${fleet.id}">
                                <!-- Signups will be loaded here -->
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(fleetDiv);
                loadScreeningSignups(fleet.id);
            });
            
            // Populate clan selects
            populateScreeningClans();
        }
        // Ship BR values
        const shipBR = {
            "Santisima": 278,
            "L'Ocean": 239,
            "Santa Ana": 225,
            "Victory": 216,
            "DLC Victory": 224,
            "Christian VII": 164,
            "Bucentaure": 161,
            "Redoutable": 148,
            "Implacable": 163,
            "St. Pavel": 150,
            "Bellona": 134,
            "3rd Rate (74)": 132,
            "Wasa": 125,
            "USS United States": 96,
            "Constitution": 96,
            "Rättvisan": 107,
            "Agamemnon": 114,
            "Leopard": 95,
            "Indefatigable": 79,
            "Ingermanland": 111,
            "Wapen von Hamburg III": 120,
            "Endymion": 85,
            "Trincomalee": 87,
            "Diana": 78,
            "L'Hermione": 72,
            "Santa Cecilia": 72,
            "Essex": 71,
            "Pirate Frigate(Cherubim)": 67,
            "Belle Poule": 65,
            "Frigate (Cherubim)": 66,
            "LGV Refit": 40,
            "Indiaman": 37,
            "Surprise": 64,
            "Renommee": 38,
            "Le Gros Ventre": 28,
            "Hercules": 58,
            "Rattlesnake Heavy": 32,
            "Pandora": 65,
            "Le Requin": 30,
            "Cerberus": 33,
            "Niagara": 25,
            "Mortar Brig": 15,
            "Prince de Neufchatel": 25,
            "Snow (Ontario)": 27,
            "Mercury": 25,
            "Rattlesnake": 22,
            "Navy Brig (Fair American)": 22,
            "Trader Snow": 26,
            "Brig (Fair American)": 20,
            "Pickle": 15,
            "Yacht": 15,
            "Privateer": 15,
            "Cutter (Alert)": 15,
            "Trader Lynx": 13,
            "Lynx": 13,
            "ADR": 143,
            "Duke Of Kent": 353,
            "San Pedro": 164
        };

        // RvR Clans
        const rvrClans = [
            "HYDRA", "TGNT", "CKA", "1ST", "ACDC", "NINE", "95TH", "REB", "RAID", 
            "SRREG", "CQRF", "NAKOR", "RED", "BTN", "DUCK", "HNS", "LRDST", "ORCAD", 
            "CRED", "KRKEN", "SCRVY", "MTG", "LEGIO", "ROVER"
        ];

        // Sample fleet composition
        const fleetComposition = [
            { ship: "Santisima", books: 5, altShip: "L'Ocean", altBooks: 5, screen: "No" },
            { ship: "Santisima", books: 5, altShip: "L'Ocean", altBooks: 5, screen: "No" },
            { ship: "L'Ocean", books: 5, altShip: "Santa Ana", altBooks: 5, screen: "No" },
            { ship: "L'Ocean", books: 5, altShip: "Santa Ana", altBooks: 5, screen: "No" },
            { ship: "Victory", books: 5, altShip: "Bucentaure", altBooks: 5, screen: "No" },
            { ship: "Victory", books: 5, altShip: "Bucentaure", altBooks: 5, screen: "No" },
            { ship: "Bucentaure", books: 5, altShip: "Implacable", altBooks: 5, screen: "No" },
            { ship: "Bucentaure", books: 5, altShip: "Implacable", altBooks: 5, screen: "No" },
            { ship: "Implacable", books: 5, altShip: "Bellona", altBooks: 5, screen: "No" },
            { ship: "Implacable", books: 5, altShip: "Bellona", altBooks: 5, screen: "No" },
            { ship: "Bellona", books: 5, altShip: "3rd Rate (74)", altBooks: 5, screen: "Yes" },
            { ship: "Bellona", books: 5, altShip: "3rd Rate (74)", altBooks: 5, screen: "Yes" },
            { ship: "Indefatigable", books: 5, altShip: "Endymion", altBooks: 5, screen: "Yes" },
            { ship: "Indefatigable", books: 5, altShip: "Endymion", altBooks: 5, screen: "Yes" },
            { ship: "Endymion", books: 5, altShip: "Trincomalee", altBooks: 5, screen: "Yes" }
        ];

        function populateClans() {
            const clansGrid = document.getElementById('clans-grid');
            rvrClans.forEach(clan => {
                const clanElement = document.createElement('div');
                clanElement.className = 'clan-tag';
                clanElement.textContent = clan;
                clansGrid.appendChild(clanElement);
            });
        }

        function createClanSelect() {
            let options = '<option value="">Select Clan</option>';
            rvrClans.forEach(clan => {
                options += `<option value="${clan}">${clan}</option>`;
            });
            return options;
        }

        function populateFleet() {
            const tbody = document.getElementById('fleet-tbody');
            const clanOptions = createClanSelect();
            
            for (let i = 0; i < 70; i++) {
                const row = document.createElement('tr');
                const fleet = fleetComposition[i] || { ship: "", books: 1, altShip: "", altBooks: 1, screen: "No" };
                const br = fleet.ship ? shipBR[fleet.ship] || 0 : 0;
                
                row.innerHTML = `
                    <td class="ship-cell">${i + 1}</td>
                    <td class="ship-cell">${fleet.ship}</td>
                    <td class="br-cell">${br}</td>
                    <td class="br-cell">${fleet.books}</td>
                    <td class="ship-cell">${fleet.altShip}</td>
                    <td class="br-cell">${fleet.altBooks}</td>
                    <td class="br-cell">${fleet.screen}</td>
                    <td><input type="text" placeholder="Your name" onchange="updateSignup(${i}, this.value)"></td>
                    <td><select onchange="updateClan(${i}, this.value)">${clanOptions}</select></td>
                    <td><textarea placeholder="Comments" maxlength="400" rows="3" style="width: 100%; resize: vertical; background: #181818; border: 1px solid #bfa140; color: #fff; padding: 0.5rem; font-family: inherit; font-size: 0.9rem;"></textarea></td>
                `;
                
                tbody.appendChild(row);
            }
        }

        function updateSignup(rowIndex, playerName) {
            const row = document.getElementById('fleet-tbody').children[rowIndex];
            if (playerName.trim()) {
                row.classList.add('signed-up');
            } else {
                row.classList.remove('signed-up');
            }
            updateBRCalculation();
        }

        function updateClan(rowIndex, clanValue) {
            // Store clan selection for this row
            console.log(`Row ${rowIndex} selected clan: ${clanValue}`);
        }

        function updateBRCalculation() {
            const rows = document.getElementById('fleet-tbody').children;
            let totalBR = 0;
            let signedShips = 0;
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const playerInput = row.querySelector('input[type="text"]');
                if (playerInput.value.trim()) {
                    const shipCell = row.children[1].textContent;
                    const br = shipBR[shipCell] || 0;
                    totalBR += br;
                    signedShips++;
                }
            }
            
            const brLimit = parseInt(document.getElementById('br-limit').textContent);
            const remaining = brLimit - totalBR;
            
            document.getElementById('br-used').textContent = totalBR;
            document.getElementById('br-remaining').textContent = remaining;
            document.getElementById('br-remaining').style.color = remaining >= 0 ? '#4ade80' : '#ff6b6b';
            document.getElementById('ships-signed').textContent = `${signedShips}/70`;
        }

        function loadApprovedParticipants() {
            // Get approved participants from localStorage (simulating server data)
            const savedSignups = localStorage.getItem(`krakenPBSignups_${pbId}`);
            const approvedSignups = savedSignups ? JSON.parse(savedSignups).filter(s => s.status === 'approved') : [];
            
            const tbody = document.getElementById('approved-tbody');
            const noApproved = document.getElementById('no-approved');
            
            if (approvedSignups.length === 0) {
                tbody.innerHTML = '';
                noApproved.style.display = 'block';
                return;
            }
            
            noApproved.style.display = 'none';
            tbody.innerHTML = '';
            
            approvedSignups.forEach((signup, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${signup.playerName}</td>
                    <td>${signup.ship}</td>
                    <td>${signup.br}</td>
                    <td>${signup.altShip || 'None'}</td>
                    <td>${signup.role || 'Fleet'}</td>
                    <td>${signup.clan}</td>
                    <td><span class="status-approved">✓ Approved</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateScreeningClans() {
            const clans = ['KRAKEN', 'NIGHT', 'RVR', 'ELITE', 'BRIT', 'CARIB', 'SPAIN', 'FRANCE', 'DUTCH', 'PIRATES'];
            
            currentPB.screening.fleets.forEach(fleet => {
                const clanSelect = document.getElementById(`clan-${fleet.id}`);
                if (clanSelect) {
                    clans.forEach(clan => {
                        const option = document.createElement('option');
                        option.value = clan;
                        option.textContent = clan;
                        clanSelect.appendChild(option);
                    });
                }
            });
        }

        function signUpForScreening(fleetId) {
            const playerName = document.getElementById(`player-name-${fleetId}`).value.trim();
            const clan = document.getElementById(`clan-${fleetId}`).value;
            const ship = document.getElementById(`ship-${fleetId}`).value.trim();
            const br = parseInt(document.getElementById(`br-${fleetId}`).value);

            if (!playerName || !clan || !ship || !br) {
                alert('Please fill in all fields');
                return;
            }

            const fleet = currentPB.screening.fleets.find(f => f.id === fleetId);
            if (!fleet) return;

            if (!fleet.signups) fleet.signups = [];

            if (fleet.signups.length >= 70) {
                alert('This fleet is full (70/70)');
                return;
            }

            // Check if player already signed up
            if (fleet.signups.some(s => s.playerName.toLowerCase() === playerName.toLowerCase())) {
                alert('You have already signed up for this fleet');
                return;
            }

            const signup = {
                id: Date.now().toString(),
                playerName: playerName,
                clan: clan,
                ship: ship,
                br: br,
                confirmed: false,
                approved: false,
                timestamp: new Date().toISOString()
            };

            fleet.signups.push(signup);
            saveScreeningData();
            loadScreeningSignups(fleetId);

            // Clear form
            document.getElementById(`player-name-${fleetId}`).value = '';
            document.getElementById(`clan-${fleetId}`).value = '';
            document.getElementById(`ship-${fleetId}`).value = '';
            document.getElementById(`br-${fleetId}`).value = '';

            alert('Signed up successfully! You will need to confirm your attendance closer to the battle.');
        }

        function loadScreeningSignups(fleetId) {
            const fleet = currentPB.screening.fleets.find(f => f.id === fleetId);
            if (!fleet || !fleet.signups) return;

            const container = document.getElementById(`signups-list-${fleetId}`);
            if (!container) return;

            if (fleet.signups.length === 0) {
                container.innerHTML = '<p style="color: #888; text-align: center; padding: 1rem;">No sign-ups yet</p>';
                return;
            }

            const table = document.createElement('table');
            table.className = 'fleet-table';
            table.innerHTML = `
                <thead>
                    <tr>
                        <th style="width: 20%;">Player</th>
                        <th style="width: 15%;">Clan</th>
                        <th style="width: 20%;">Ship</th>
                        <th style="width: 10%;">BR</th>
                        <th style="width: 15%;">Status</th>
                        <th style="width: 20%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${fleet.signups.map(signup => `
                        <tr>
                            <td>${signup.playerName}</td>
                            <td>${signup.clan}</td>
                            <td>${signup.ship}</td>
                            <td>${signup.br}</td>
                            <td>
                                <span style="color: ${signup.approved ? '#4ade80' : signup.confirmed ? '#fbbf24' : '#ef4444'};">
                                    ${signup.approved ? '✓ Approved' : signup.confirmed ? '⏳ Confirmed' : '❌ Unconfirmed'}
                                </span>
                            </td>
                            <td>
                                ${!signup.confirmed ? 
                                    `<button onclick="confirmScreeningAttendance('${fleetId}', '${signup.id}')" class="btn btn-small" style="padding: 0.25rem 0.5rem; font-size: 0.8rem;">Confirm</button>` :
                                    '<span style="color: #4ade80;">Confirmed</span>'
                                }
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            `;

            container.innerHTML = '';
            container.appendChild(table);
        }

        function confirmScreeningAttendance(fleetId, signupId) {
            const fleet = currentPB.screening.fleets.find(f => f.id === fleetId);
            if (!fleet) return;

            const signup = fleet.signups.find(s => s.id === signupId);
            if (!signup) return;

            signup.confirmed = true;
            saveScreeningData();
            loadScreeningSignups(fleetId);
            alert('Attendance confirmed! Admin will review your sign-up.');
        }

        function saveScreeningData() {
            // Update the PB data in localStorage
            const savedData = localStorage.getItem('krakenPBData');
            if (savedData) {
                const portBattles = JSON.parse(savedData);
                const pbIndex = portBattles.findIndex(pb => pb.id === currentPB.id);
                if (pbIndex !== -1) {
                    portBattles[pbIndex] = currentPB;
                    localStorage.setItem('krakenPBData', JSON.stringify(portBattles));
                }
            }
        }        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Load and verify PB data first
            if (!loadPBData()) {
                return; // Exit if data loading failed
            }
            
            loadPBDetails();
            populateClans();
            populateFleet();
            loadApprovedParticipants();
            
            // Auto-save functionality
            setInterval(() => {
                // In a real implementation, this would save to a database
                console.log('Auto-saving sign-up data...');
            }, 30000); // Save every 30 seconds
        });
    </script>
</body>
</html>
